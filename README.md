# YouGrow - DBT Project

## Intro
This project uses DBT (Data Build Tool) on top of a Postgres DB to conduct analytics for the company YouGrow.

- **Staging Layer**: Raw data from seed files is cleaned and normalized with lightweight transformations to prepare the data for further processing. This layer is constructed as views to reduce resource usage and complexity.
- **Marts Layer**: The models in the marts layer are materialized as tables, representing business-ready data optimized for reporting and analytics.
- **Reporting Layer**: The reports to end users are contained in the reporting folder and built as views. If these views begin to take too long to build for end users as the data scales, these should be converted to tables.

I decided to constructed two enriched fact tables. First, I built fct_order_line_items_enriched which I used to aggregate to fct_orders_enriched. fct_orders_enriched is used exclusively for the reporting layer in this project. As the data scales, it might be worth considering removing the fct_order_line_items_enriched table and building just the fct_orders_enriched table, but this decision depends on the usefulness and cost of the fct_order_line_items_enriched table. The same could be said for the unenriched fact tables. If they prove to be less useful for end users and BI systems, it would be worth removing them while considering the fact that some BI systems are more performant opperating on top of a star schema.


## Project Structure
```bash
├── models/
│   ├── staging/
│   ├── marts/
│   └── reporting/  
├── seed/
├── dbt_project.yml
├── README.md
└── requirements.txt
```

## Requirements
- Ensure Docker is installed on your machine. You can download it from: https://www.docker.com/products/docker-desktop

Ensure all required packages are installed by running the following:
```bash
pip install -r requirements.txt
dbt deps
```

The following dependencies are necessary for running the project. These are managed in the `requirements.txt` file:
- dbt-postgres

### PostgreSQL Setup
To create a local PostgreSQL instance using Docker, run the following command:
```bash
docker run --name postgres \
    -e POSTGRES_USER=myusername \
    -e POSTGRES_PASSWORD=mypassword \
    -p 5432:5432 \
    -v /your/local/path:/var/lib/postgresql/data \
    -d postgres
```
Make sure to replace `/your/local/path` with the actual directory on your machine where you'd like to store the PostgreSQL data.


## Assumptions
I excluded refunds from reporting layer models, as I assumed these records should not factor in to the metrics below, but this would generally require a deeper discussion with the business to confirm.

## Questions

**Question 1**: 

To provide monthly order level KPIs I could rely solely on the fct_orders_enriched table. All 4 metrics can be calculated together in an aggregated table, which I did in the kpis_monthly model in the reporting folder.

**Question 2**: 

For customer LTV and retention rate, the same fct_orders_enriched model can be utilized to build out a cohort analysis. If the end user is sql savvy or the variety of requests are limited, the analysis could be generated by simply swapping out fields in the examples within the reporting folder (ltv_by_gender and retention_by_gender) and brought into a Google Sheet. LTV and retention were split into separate analyses because their calculations are significantly different. In this case, LTV is cumulative and retention is tracked as a point in time.

If the end user is not SQL savvy or you need a more dynamic solution, the fct_orders_enriched table could be brought directly into a BI tool where the transformations can be configured to work dynamically. As mentioned in the intro, depending on the tool that's being used, it might even be more performant to use the unenriched fact tables and dimension tables within the dashboard.

**Question 3**: 

For a subscription model, I would need to know what the subscription does for the customer. Does it give discounts to the customer for the other products, or does it function as an independent product that provides additional benefits?

Depending on the answer to the above, it could make sense to include the subscription as a product in the dim_product table with a new product_type field to indicate whether or not it is a subscription product with a start and end date (if applicable).

An alternative could be to track customers that are subscribed in a separate dimension table. This would make applying discounts to products purchased under a subscribed customer easy, by tying the subscription status to the order using the subscriptions valid date range and the order date. This subscription table would need to be tracked across time and would need a SCD Type 2 model to be implemented to ensure all of the cancellations/renewals/etc. are captured across time.

Assuming there are monthly payments, this table could then be broken out into individual records where each record is treated as a new, monthly order to pair the granularity with the orders table and then unioned so that they can be tracked uniformly with the others. If this was the case, the existing KPI model would not need to be modified as it would integrate seamlessly. I would generate a new cohort analysis for retention, though, because the business model behind it is quite different than the existing one. LTV could stay the same.
